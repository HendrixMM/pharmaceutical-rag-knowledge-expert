# NVIDIA API Configuration
NVIDIA_API_KEY=your_nvidia_api_key_here

# Optional: Other configuration
DOCS_FOLDER=Data/Docs
VECTOR_DB_PATH=./vector_db
CHUNK_SIZE=1000
CHUNK_OVERLAP=200

# Vector Database Configuration
# Defaults to false to retain the legacy single-directory layout. Set true to store FAISS indexes under sanitized,
# model-specific subdirectories (e.g., ./vector_db/nvidia_llama-3.2-nemoretriever-1b-vlm-embed-v1). Compatible legacy
# indexes in VECTOR_DB_PATH migrate automatically on first run; mismatched models or dimensions force a rebuild at the
# destination path.
VECTOR_DB_PER_MODEL=false

# PubMed Scraping Configuration
# Apify API token (https://console.apify.com)
APIFY_TOKEN=your_apify_token_here
# Cache directory for results
PUBMED_CACHE_DIR=./pubmed_cache
# Cache TTL in hours (default: 24)
PUBMED_CACHE_TTL_HOURS=24
# PubMed cache behavior (optional)
# Cache empty results to avoid refetch loops
CACHE_EMPTY_RESULTS=false
# TTL for empty caches (<= PUBMED_CACHE_TTL_HOURS)
EMPTY_CACHE_TTL_SECONDS=300
# Try alternative EasyAPI input schemas if default fails

# EasyAPI PubMed Configuration
# Note: Requires EasyAPI subscription on Apify for enhanced PubMed scraping capabilities
EASYAPI_ACTOR_ID=easyapi/pubmed-search-scraper
DEFAULT_MAX_ITEMS=30
HARD_CAP_MAX_ITEMS=100
# Informational only - used for logging budget awareness, no enforcement
MONTHLY_BUDGET_LIMIT=19.99
EXTRACT_TAGS=true
# When rank=True, tag extraction is auto-enabled for ranking even if this is false (to keep scoring signals available)
USE_FULL_ABSTRACTS=true
# Preserve-order runs (PRESERVE_PUBMED_ORDER=true with rank=False) skip abstracts to reduce cost; set rank=True or disable preserve order to include abstracts
# Study ranking is disabled by default to preserve native PubMed ordering; set true to enable automatic ranking
ENABLE_STUDY_RANKING=false
# Preserve original PubMed result ordering (disables ranking regardless of per-call rank overrides)
PRESERVE_PUBMED_ORDER=false
# Controls DOI and PMID deduplication (formerly ENABLE_PMID_DEDUPLICATION)
ENABLE_DEDUPLICATION=true
# Enable pharmaceutical query expansion with related terms
ENABLE_PHARMA_QUERY_ENHANCEMENT=true
# Enable pharmaceutical enhancement for advanced PubMed queries (field qualifiers, deep nesting, quoted phrases).
# Keeping this disabled avoids rewriting precise expert queries; set true only when expansion benefits outweigh the risk.
ENABLE_PHARMA_ENHANCE_ADVANCED=false
# Maximum number of enhancement clauses appended during pharmaceutical query expansion (set â‰¤ 0 for no cap)
PHARMA_MAX_TERMS=8
# Optional comma-separated terms appended to the pharmaceutical enhancement list (deduplicated case-insensitively)
PHARMA_EXTRA_TERMS=
# Override or extend MeSH qualifiers appended during pharmaceutical enhancement (comma-separated, case-insensitive dedupe)
PHARMA_MESH_QUALIFIERS=drug interactions[MeSH Terms],Cytochrome P-450 Enzyme System[MeSH]
# Maximum enhanced query length to prevent overly long URLs
MAX_QUERY_LENGTH=1800
# PubMed scraper provider identifier for downstream filter compatibility (exposed via provider_detail/provider_variant)
SCRAPER_PROVIDER=apify-easyapi
# Comma-separated list of actor schemas to try in addition to searchUrls (EasyAPI actor supports searchUrls only)
EASYAPI_FALLBACK_SCHEMAS=
# Enable schema fallback (disabled for EasyAPI actor; set true only if alternate schemas are supported)
ENABLE_EASYAPI_SCHEMA_FALLBACK=false
# Toggle automatic schema fallback when the actor returns 4xx validation errors
EASYAPI_SMART_SCHEMA_FALLBACK=true

# EasyAPI Optional Flags Configuration
# Control whether to include tags in EasyAPI requests (defaults to true). When rank=True the scraper forces includeTags regardless of this setting.
#EASYAPI_INCLUDE_TAGS=true
# Control whether to include abstracts in EasyAPI requests (defaults to true)
#EASYAPI_INCLUDE_ABSTRACT=true

# Pharmaceutical Lexicon Configuration
# Curated lexicons are bundled in data/ directory for comprehensive drug detection
# Override with custom paths if needed (one drug name per line, # for comments)
DRUG_GENERIC_LEXICON=./data/drugs_generic.txt
DRUG_BRAND_LEXICON=./data/drugs_brand.txt
# CYP enzyme role mappings are automatically loaded from data/cyp_roles.csv

# Rate Limiting and Enhanced PubMed Scraper Configuration
# Enable NCBI-compliant rate limiting across PubMed scraping workflows (independent of ENABLE_ENHANCED_PUBMED_SCRAPER)
ENABLE_RATE_LIMITING=false
# Maximum allowed requests per second (NCBI recommends <= 3 req/s)
MAX_REQUESTS_PER_SECOND=3
# Maximum allowed requests per day before automatic throttling (0 or -1 disables the daily quota)
DAILY_REQUEST_LIMIT=500
# Toggle advanced detection of NCBI-recommended off-peak hours (9 PM - 5 AM ET)
ENABLE_OPTIMAL_TIMING_DETECTION=true
# Treat weekends as fully optimal for long-running jobs (set false to apply only nightly windows)
RATE_LIMIT_WEEKEND_OPTIMAL=true
# Logging verbosity for rate limiting diagnostics (DEBUG, INFO, WARNING, ERROR)
RATE_LIMITING_LOG_LEVEL=INFO
# Raise an error instead of waiting when the daily quota is exhausted
RATE_LIMIT_RAISE_ON_DAILY_LIMIT=false
# Maximum seconds to wait for daily reset before raising (default: 1 hour; blank disables the guard)
RATE_LIMIT_MAX_DAILY_WAIT_SECONDS=3600
# Share a single rate limiter across all scraper instances in the process
USE_PROCESS_WIDE_LIMITER=false

# Embedding Model Preference
# Preferred embedding model
EMBEDDING_MODEL_NAME=nvidia/llama-3.2-nemoretriever-1b-vlm-embed-v1
# Optional fallback when preferred model is unavailable
EMBEDDING_FALLBACK_MODEL=nvidia/nv-embed-v1
# Optional: override the NVIDIA embedding endpoint (defaults to https://integrate.api.nvidia.com/v1)
# EMBEDDING_BASE_URL=https://integrate.api.nvidia.com/v1
# Embedding runtime tuning (optional)
# Batch size for embedding requests
EMBEDDING_BATCH_SIZE=10
# Probe preferred model at startup (fallback if unavailable)
EMBEDDING_PROBE_ON_INIT=true
# Control question-time preflight embedding. When true (default), skip the extra embedding call per
# question to minimize latency/cost. Set to false to opt into the preflight check, which adds an extra
# embedding call per query but detects runtime fallbacks before querying FAISS.
DISABLE_PREFLIGHT_EMBEDDING=false
# Number of pages to scan when extracting PubMed metadata (default: 3)
PUBMED_SCAN_PAGES=3

# LLM Configuration
# LLM model for text generation (default: meta/llama-3.1-8b-instruct)
LLM_MODEL_NAME=meta/llama-3.1-8b-instruct
# Whether to append medical disclaimer to answer text (default: true)
# Set to false only when the UI exclusively renders RAGResponse.disclaimer and prefers to strip duplicates
APPEND_DISCLAIMER_IN_ANSWER=true
